#############################
## Buildings / Business City
#############################

building_business_city_01 = {
    is_listed = yes
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_business_city_01"
    tags = {}

    base_buildtime = 750

    prerequisites = {
        "tech_agglomerate_construction"
    }

    upgrades = {
        "building_business_city_02"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 300
        energy = 300
        influence = 5
    }

    required_resources = {
        energy = 1
    }

    produced_resources = {
        minerals = 1
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 2
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.02
        pop_migration_time = -0.02
        pop_happiness = -0.01
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_tropical
                is_planet_class = pc_continental
                is_planet_class = pc_tundra
                is_planet_class = pc_gaia
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_steppe
                is_planet_class = pc_geothermal
                is_planet_class = pc_desertislands
                is_planet_class = pc_mesa
                is_planet_class = pc_oasis
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_continental
                    is_planet_class = pc_tundra
                    is_planet_class = pc_gaia
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_steppe
                    is_planet_class = pc_geothermal
                    is_planet_class = pc_desertislands
                    is_planet_class = pc_mesa
                    is_planet_class = pc_oasis
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_building_capital_1_or_hab"
                planet = {
                    OR = {
                        has_building = "building_hab_capital"
                        has_building = "building_capital_1"
                        has_building = "building_capital_2"
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_5"
                planet = {
                    count_pops = {
                        count > 4
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 50
    }

    ai_special_building = no
    ai_replace = yes
}

building_business_city_02 = {
    is_listed = no
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_business_city_02"
    tags = {}

    base_buildtime = 1500

    prerequisites = {
        "tech_continental_construction"
    }

    upgrades = {
        "building_business_city_03"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 600
        energy = 600
        influence = 10
    }

    required_resources = {
        energy = 2
    }

    produced_resources = {
        minerals = 2
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 3
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.04
        pop_migration_time = -0.04
        pop_happiness = -0.02
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_tropical
                is_planet_class = pc_continental
                is_planet_class = pc_tundra
                is_planet_class = pc_gaia
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_steppe
                is_planet_class = pc_geothermal
                is_planet_class = pc_desertislands
                is_planet_class = pc_mesa
                is_planet_class = pc_oasis
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_continental
                    is_planet_class = pc_tundra
                    is_planet_class = pc_gaia
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_steppe
                    is_planet_class = pc_geothermal
                    is_planet_class = pc_desertislands
                    is_planet_class = pc_mesa
                    is_planet_class = pc_oasis
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_building_capital_2"
                planet = {
                    OR = {
                        has_building = "building_capital_2"
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_10"
                planet = {
                    count_pops = {
                        count > 9
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 70
    }

    ai_special_building = no
    ai_replace = yes
}

building_business_city_03 = {
    is_listed = no
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_business_city_03"
    tags = {}

    base_buildtime = 3000

    prerequisites = {
        "tech_planetary_construction"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 1500
        energy = 1500
        influence = 20
    }

    required_resources = {
        energy = 4
    }

    produced_resources = {
        minerals = 10
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 4
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.06
        pop_migration_time = -0.06
        pop_happiness = -0.04
    }

    adjacency_bonus = {
        tile_building_resource_minerals_add = 2
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_tropical
                is_planet_class = pc_continental
                is_planet_class = pc_tundra
                is_planet_class = pc_gaia
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_steppe
                is_planet_class = pc_geothermal
                is_planet_class = pc_desertislands
                is_planet_class = pc_mesa
                is_planet_class = pc_oasis
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_continental
                    is_planet_class = pc_tundra
                    is_planet_class = pc_gaia
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_steppe
                    is_planet_class = pc_geothermal
                    is_planet_class = pc_desertislands
                    is_planet_class = pc_mesa
                    is_planet_class = pc_oasis
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_building_capital_3"
                planet = {
                    OR = {
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_15"
                planet = {
                    count_pops = {
                        count > 14
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 85
    }

    ai_special_building = no
    ai_replace = yes
}

###############################
## Buildings / Industrial City
###############################

building_industrial_city_01 = {
    is_listed = yes
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_industrial_city_01"
    tags = {}

    base_buildtime = 750

    prerequisites = {
        "tech_agglomerate_construction"
    }

    upgrades = {
        "building_industrial_city_02a"
        "building_industrial_city_02b"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 300
        energy = 300
        influence = 5
    }

    required_resources = {
        minerals = 1
    }

    produced_resources = {
        energy = 3
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 2
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.02
        pop_migration_time = -0.02
        pop_happiness = -0.01
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_tropical
                is_planet_class = pc_continental
                is_planet_class = pc_tundra
                is_planet_class = pc_gaia
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_steppe
                is_planet_class = pc_geothermal
                is_planet_class = pc_desertislands
                is_planet_class = pc_mesa
                is_planet_class = pc_oasis
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_continental
                    is_planet_class = pc_tundra
                    is_planet_class = pc_gaia
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_steppe
                    is_planet_class = pc_geothermal
                    is_planet_class = pc_desertislands
                    is_planet_class = pc_mesa
                    is_planet_class = pc_oasis
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_building_capital_1_or_hab"
                planet = {
                    OR = {
                        has_building = "building_hab_capital"
                        has_building = "building_capital_1"
                        has_building = "building_capital_2"
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_5"
                planet = {
                    count_pops = {
                        count > 4
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 50
    }

    ai_special_building = no
    ai_replace = yes
}

building_industrial_city_02a = {
    is_listed = no
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_industrial_city_02a"
    tags = {}

    base_buildtime = 1500

    prerequisites = {
        "tech_continental_construction"
    }

    upgrades = {
        "building_industrial_city_03a"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 600
        energy = 600
        influence = 10
    }

    required_resources = {
        minerals = 2
    }

    produced_resources = {
        energy = 5
        engineering_research = 3
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 3
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.03
        pop_migration_time = -0.03
        pop_happiness = -0.02
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_tropical
                is_planet_class = pc_continental
                is_planet_class = pc_tundra
                is_planet_class = pc_gaia
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_steppe
                is_planet_class = pc_geothermal
                is_planet_class = pc_desertislands
                is_planet_class = pc_mesa
                is_planet_class = pc_oasis
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_continental
                    is_planet_class = pc_tundra
                    is_planet_class = pc_gaia
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_steppe
                    is_planet_class = pc_geothermal
                    is_planet_class = pc_desertislands
                    is_planet_class = pc_mesa
                    is_planet_class = pc_oasis
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_building_capital_2"
                planet = {
                    OR = {
                        has_building = "building_capital_2"
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_10"
                planet = {
                    count_pops = {
                        count > 9
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 75
    }

    ai_special_building = no
    ai_replace = yes
}

building_industrial_city_02b = {
    is_listed = no
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_industrial_city_02b"
    tags = {}

    base_buildtime = 1500

    prerequisites = {
        "tech_continental_construction"
    }

    upgrades = {
        "building_industrial_city_03b"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 600
        energy = 600
        influence = 10
    }

    required_resources = {
        minerals = 2
    }

    produced_resources = {
        energy = 5
        physics_research = 3
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 3
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.03
        pop_migration_time = -0.03
        pop_happiness = -0.02
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_tropical
                is_planet_class = pc_continental
                is_planet_class = pc_tundra
                is_planet_class = pc_gaia
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_steppe
                is_planet_class = pc_geothermal
                is_planet_class = pc_desertislands
                is_planet_class = pc_mesa
                is_planet_class = pc_oasis
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_continental
                    is_planet_class = pc_tundra
                    is_planet_class = pc_gaia
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_steppe
                    is_planet_class = pc_geothermal
                    is_planet_class = pc_desertislands
                    is_planet_class = pc_mesa
                    is_planet_class = pc_oasis
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_building_capital_2"
                planet = {
                    OR = {
                        has_building = "building_capital_2"
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_10"
                planet = {
                    count_pops = {
                        count > 9
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 75
    }

    ai_special_building = no
    ai_replace = yes
}

building_industrial_city_03a = {
    is_listed = no
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_industrial_city_03a"
    tags = {}

    base_buildtime = 3500

    prerequisites = {
        "tech_intercontinental_construction"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 1700
        energy = 1700
        influence = 25
    }

    required_resources = {
        minerals = 4
    }

    produced_resources = {
        energy = 10
        engineering_research = 6
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 4
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.04
        pop_migration_time = -0.04
        pop_happiness = -0.04
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_tropical
                is_planet_class = pc_continental
                is_planet_class = pc_tundra
                is_planet_class = pc_gaia
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_steppe
                is_planet_class = pc_geothermal
                is_planet_class = pc_desertislands
                is_planet_class = pc_mesa
                is_planet_class = pc_oasis
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_continental
                    is_planet_class = pc_tundra
                    is_planet_class = pc_gaia
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_steppe
                    is_planet_class = pc_geothermal
                    is_planet_class = pc_desertislands
                    is_planet_class = pc_mesa
                    is_planet_class = pc_oasis
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_building_capital_3"
                planet = {
                    OR = {
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_15"
                planet = {
                    count_pops = {
                        count > 14
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 90
    }

    ai_special_building = no
    ai_replace = yes
}

building_industrial_city_03b = {
    is_listed = no
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_industrial_city_03b"
    tags = {}

    base_buildtime = 3500

    prerequisites = {
        "tech_intercontinental_construction"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 1700
        energy = 1700
        influence = 25
    }

    required_resources = {
        minerals = 4
    }

    produced_resources = {
        energy = 10
        physics_research = 6
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 4
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.04
        pop_migration_time = -0.04
        pop_happiness = -0.04
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_tropical
                is_planet_class = pc_continental
                is_planet_class = pc_tundra
                is_planet_class = pc_gaia
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_steppe
                is_planet_class = pc_geothermal
                is_planet_class = pc_desertislands
                is_planet_class = pc_mesa
                is_planet_class = pc_oasis
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_continental
                    is_planet_class = pc_tundra
                    is_planet_class = pc_gaia
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_steppe
                    is_planet_class = pc_geothermal
                    is_planet_class = pc_desertislands
                    is_planet_class = pc_mesa
                    is_planet_class = pc_oasis
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_building_capital_3"
                planet = {
                    OR = {
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_15"
                planet = {
                    count_pops = {
                        count > 14
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 90
    }

    ai_special_building = no
    ai_replace = yes
}

#############################
## Buildings / Atlantis City
#############################

building_atlantis_city_01 = {
    is_listed = yes
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_atlantis_city_01"
    tags = {}

    base_buildtime = 1000

    prerequisites = {
        "tech_oceanic_construction"
    }

    upgrades = {
        "building_atlantis_city_02"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 400
        energy = 400
        influence = 5
    }

    required_resources = {
        energy = 1
        minerals = 1
    }

    produced_resources = {
        influence = 3
        society_research = 1
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 3
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.03
        pop_migration_time = -0.03
        pop_happiness = -0.01
        pop_xenophobia = -0.03
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_ocean
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_tidallylocked
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_ocean
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_tidallylocked
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_atlantis_city_limit_5"
                owner = {
                    OR = {
                        has_technology = "tech_underwater_construction"
                        has_technology = "tech_deepwater_construction"
                    }
                }
                planet = {
                    check_variable = {
                        which = "atlantis_city_built"
                        value < 5
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_atlantis_city_limit_10"
                owner = {
                    has_technology = "tech_deepwater_construction"
                }
                planet = {
                    check_variable = {
                        which = "atlantis_city_built"
                        value < 10
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_atlantis_city_limit_15"
                planet = {
                    check_variable = {
                        which = "atlantis_city_built"
                        value < 15
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_atlantis_city_not_queued"
                planet = {
                    has_planet_flag = "atlantis_city_queued"
                }
            }
            custom_tooltip = {
                fail_text = "requires_building_capital_1_or_hab"
                planet = {
                    OR = {
                        has_building = "building_hab_capital"
                        has_building = "building_capital_1"
                        has_building = "building_capital_2"
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_5"
                planet = {
                    count_pops = {
                        count > 4
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 70
    }

    ai_special_building = no
    ai_replace = yes
}

building_atlantis_city_02 = {
    is_listed = no
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_atlantis_city_02"
    tags = {}

    base_buildtime = 2500

    prerequisites = {
        "tech_underwater_construction"
    }

    upgrades = {
        "building_atlantis_city_03"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 900
        energy = 900
        influence = 12
    }

    required_resources = {
        energy = 3
        minerals = 2
    }

    produced_resources = {
        influence = 6
        society_research = 2
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 6
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.05
        pop_migration_time = -0.05
        pop_happiness = -0.02
        pop_xenophobia = -0.06
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_ocean
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_tidallylocked
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_ocean
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_tidallylocked
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_atlantis_city_limit_10"
                owner = {
                    has_technology = "tech_deepwater_construction"
                }
                planet = {
                    check_variable = {
                        which = "atlantis_city_built"
                        value < 10
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_atlantis_city_limit_15"
                planet = {
                    check_variable = {
                        which = "atlantis_city_built"
                        value < 15
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_atlantis_city_not_queued"
                planet = {
                    has_planet_flag = "atlantis_city_queued"
                }
            }
            custom_tooltip = {
                fail_text = "requires_building_capital_2"
                planet = {
                    OR = {
                        has_building = "building_capital_2"
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_10"
                planet = {
                    count_pops = {
                        count > 9
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 85
    }

    ai_special_building = no
    ai_replace = yes
}

building_atlantis_city_03 = {
    is_listed = no
    empire_unique = no
    planet_unique = no
    requires_pop = yes
    event_building = no
    can_demolish = yes
    icon = "building_atlantis_city_03"
    tags = {}

    base_buildtime = 5000

    prerequisites = {
        "tech_deepwater_construction"
    }

    show_tech_unlock_if = {
        NOT = {
            has_authority = "auth_machine_intelligence"
        }
    }

    cost = {
        minerals = 2000
        energy = 2000
        influence = 25
    }

    required_resources = {
        energy = 3
        minerals = 2
    }

    produced_resources = {
        influence = 10
        society_research = 5
    }

    produced_resource_trigger = {
        modifier = {
            has_technology = "tech_supreme_engineering"
            resources = {
                unity = 10
            }
        }
    }

    planet_modifier = {
        pop_growth_speed = 0.07
        pop_migration_time = -0.07
        pop_happiness = -0.03
        pop_xenophobia = -0.09
    }

    potential = {
        owner = {
            NOT = {
                has_authority = "auth_machine_intelligence"
            }
        }
        planet = {
            OR = {
                is_planet_class = pc_ocean
                # @depend "Planetary Diversity" (id:819148835)
                is_planet_class = pc_tidallylocked
            }
        }
    }

    destroy_if = {
        OR = {
            AND = {
                exists = owner
                owner = {
                    has_authority = "auth_machine_intelligence"
                }
            }
            planet = {
                NAND = {
                    is_planet_class = pc_ocean
                    # @depend "Planetary Diversity" (id:819148835)
                    is_planet_class = pc_tidallylocked
                }
            }
        }
    }

    allow = {
        AND = {
            custom_tooltip = {
                fail_text = "requires_atlantis_city_limit_15"
                planet = {
                    check_variable = {
                        which = "atlantis_city_built"
                        value < 15
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_atlantis_city_not_queued"
                planet = {
                    has_planet_flag = "atlantis_city_queued"
                }
            }
            custom_tooltip = {
                fail_text = "requires_building_capital_3"
                planet = {
                    OR = {
                        has_building = "building_capital_3"
                    }
                }
            }
            custom_tooltip = {
                fail_text = "requires_colony_indigenous_settlements_15"
                planet = {
                    count_pops = {
                        count > 14
                        limit = {
                            is_robot_pop = no
                            is_enslaved = no
                            is_being_purged = no
                        }
                    }
                }
            }
        }
    }

    ai_allow = {
        is_slave_tile_or_planet = no
        is_robot_tile_or_planet = no
    }

    ai_weight = {
        factor = 100
    }

    ai_special_building = no
    ai_replace = yes
}